{% extends 'base.html' %}
{% load static %}

{% block title %}Stefi - Plan Your Perfect Trip{% endblock %}

{% block extra_css %}
<style>
    /* Hero Section */
    .hero-section {
        position: relative;
        height: 100vh;
        color: white;
        overflow: hidden;
        padding: 6rem 0;
    }

    .hero-video {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        z-index: -2;
    }

    .hero-section .overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -1;
    }



    /* State Carousel */
    .state-carousel {
        padding: 2rem 0;
    }

    .state-card {
        border: none;
        border-radius: 15px;
        overflow: hidden;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        height: 100%;
    }

    .state-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
    }

    .state-image {
        height: 200px;
        object-fit: cover;
    }

    .state-overlay {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        background: linear-gradient(transparent, rgba(0, 0, 0, 0.8));
        padding: 1rem;
        color: white;
    }

    /* Destination Grid */
    .destination-card {
        border: none;
        border-radius: 15px;
        overflow: hidden;
        transition: transform 0.3s ease;
        height: 100%;
    }

    .destination-card:hover {
        transform: translateY(-3px);
    }

    .destination-image {
        height: 250px;
        object-fit: cover;
    }

    .badge-destination {
        position: absolute;
        top: 1rem;
        right: 1rem;
        background: var(--primary-color);
        color: white;
    }





    /* Destination Selection Styles */
    .destination-selection {
        max-height: 70vh;
        overflow-y: auto;
    }

    .destination-main-image {
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }

    .option-card {
        transition: all 0.3s ease;
        cursor: pointer;
        height: 100%;
    }

    .option-card:hover {
        background: linear-gradient(135deg, #f8f9fa, #e9ecef);
    }

    .option-icon {
        width: 60px;
        height: 60px;
        transition: transform 0.3s ease;
    }

    .option-card:hover .option-icon {
        transform: scale(1.1);
    }

    .stat {
        padding: 0.5rem;
    }

    .stat-number {
        font-size: 1.5rem;
        font-weight: bold;
    }

    .stat-label {
        color: #6c757d;
        font-size: 0.8rem;
    }

    .trip-item {
        transition: all 0.3s ease;
        cursor: pointer;
    }

    .trip-item:hover {
        border-color: var(--primary-color);
        background: #f8f9fa;
    }

    .hover-lift {
        transition: all 0.3s ease;
    }

    .hover-lift:hover {
        transform: translateY(-2px);
    }

    /* Toast positioning */
    .toast-container {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 9999;
    }

    .floating-search-icon {
        border-radius: 0 50px 50px 0;
        background: #e6e9f3bf;
        margin: 0 !important;
    }

    .floating-search-input {
        background: #e6e9f3bf;
        box-shadow: none;
    }

    .floating-search-input::placeholder {
        color: #363636;
    }

    .floating-search-logo {
        background: #e6e9f3bf;
        margin: 0 !important;
        padding: 7px;
    }

    /* Carousel */
    .carousel-container {
        width: 100%;
        position: relative;
        padding: 20px 0;
        touch-action: pan-y;
        max-width: 800px;
    }

    .carousel {
        display: flex;
        padding: 30px 10px;
        cursor: grab;
        user-select: none;
        will-change: transform;
        top: 15%;
        position: relative;
        justify-content: center;
        align-items: center;
        transition: transform 0.6s ease;
    }

    #carouselContainer .card {
        flex: 0 0 280px;
        margin: 0 15px;
        background: white;
        border-radius: 16px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        text-align: left;
        overflow: hidden;
        transition: transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94),
            opacity 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94),
            box-shadow 0.4s ease;
        opacity: 0.8;
        width: 200px;
        height: 380px;
        position: absolute;
    }

    #carouselContainer .card img {
        width: 100%;
        height: 280px;
        object-fit: cover;
        transition: transform 0.4s ease;
        padding: 12px;
        border-radius: 20px;
    }

    #carouselContainer .card-content {
        padding: 15px;
    }

    #carouselContainer .card h3 {
        margin: 0px;
        font-size: 15px;
        color: #2c3e50;
        padding: 5px;
    }

    #carouselContainer .card p {
        margin: 0;
        font-size: 12px;
        color: #7f8c8d;
        line-height: 1.5;
        padding: 5px;
    }

    #carouselContainer .card.active {
        transform: scale(1.2) translateX(0);
        opacity: 1;
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
        z-index: 10;
    }

    #carouselContainer .card.active img {
        transform: scale(1.05);
    }

    #carouselContainer .card.dragging {
        transition: none;
        cursor: grabbing;
    }

    /* side cards */
    #carouselContainer .card.left {
        transform: translateX(-160px) scale(0.9);
        opacity: 0.7;
        z-index: 2;
    }

    #carouselContainer .card.right {
        transform: translateX(160px) scale(0.9);
        opacity: 0.7;
        z-index: 2;
    }

    /* hidden cards further away */
    #carouselContainer .card.hidden {
        opacity: 0;
        transform: scale(0.7);
        pointer-events: none;
    }

    /* Indicators */
    #carouselContainer .indicators {
        display: flex;
        justify-content: center;
        margin-top: 25px;
        gap: 12px;
    }

    #carouselContainer .indicator {
        width: 14px;
        height: 14px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.5);
        cursor: pointer;
        transition: all 0.3s ease;
    }

    #carouselContainer .indicator.active {
        background: white;
        transform: scale(1.3);
    }

    /* Pause/Play button */
    #carouselContainer .control-btn {
        background: rgba(255, 255, 255, 0.2);
        border: 2px solid white;
        color: white;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        margin-top: 20px;
        cursor: pointer;
        font-size: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
    }

    #carouselContainer .control-btn:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: scale(1.1);
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
        #carouselContainer .card {
            flex: 0 0 220px;
        }
    }

    @media (max-width: 480px) {
        #carouselContainer .card {
            flex: 0 0 200px;
            margin: 0 10px;
        }
    }


    .achivements-count-div {
        background-color: white;
        border-radius: 50%;
        height: 150px;
        width: 150px;
        display: flex;
        flex-direction: column;
        flex-wrap: nowrap;
        justify-content: center;
        align-items: center;
    }

    .achivement-path-vector {
        background: url({% static 'assets/images/achivement-vector-bg.png' %}) no-repeat center center;
        background-size: contain;
    }

    .achivement-section {
        background: linear-gradient(180deg, #36CAFF -55.86%, #207999 100%);
    }

    .stefi-different-section {
        background: url(/static/assets/images/mountain.jpg) no-repeat center center;
        margin: 50px 0;
        background-size: cover;
        margin: 56px;
        border-radius: 26px;
    }

    .card2s {
        display: flex;
        gap: 30px;
        justify-content: center;
        perspective: 1000px;
    }

    .card2 {
        background: rgba(229, 233, 243, 0.8);
        border-radius: 15px;
        padding: 30px 20px;
        /* width: 250px; */
        transition: transform 0.5s, box-shadow 0.5s;
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        transform-style: preserve-3d;
        cursor: pointer;
    }

    .card2:hover {
        transform: rotateY(15deg) rotateX(10deg) translateZ(20px);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
    }

    .card2-icon {
        font-size: 2em;
        margin-bottom: 20px;
    }

    .card2 h3 {
        margin-bottom: 15px;
        font-size: 1.2em;
        font-weight: bold;
    }

    .card2 p {
        font-size: 0.9em;
        color: #555;
    }

    /* Optional: Icon styles using Unicode */
    .icon-calendar::before {
        content: "\1F4C5";
    }

    .icon-rupee::before {
        content: "\20B9";
    }

    .icon-invoice::before {
        content: "\1F4C4";
    }
</style>
<style>
    .carousel1 {
        width: 100%;
        /* max-width: 1000px; */
        overflow: hidden;
        position: relative;
        cursor: grab;
        perspective: 1200px;
        /* padding: 0 16px; */
    }

    .carousel1:active {
        cursor: grabbing;
    }

    .track {
        display: flex;
        transition: transform 0.8s cubic-bezier(.25, .8, .25, 1);
    }

    .card1 {
        flex: 0 0 33.333%;
        /* margin: 0 8px; */
        border-radius: 14px;
        background: #111827;
        color: #fff;
        overflow: hidden;
        position: relative;
        user-select: none;
        transform: scale(0.95);
        transition: transform 0.6s ease;
    }

    .card1 img {
        width: 100%;
        height: 220px;
        object-fit: cover;
        display: block;
        transition: transform 0.6s ease;
        pointer-events: none;
    }

    .card1:hover img {
        transform: scale(1.1);
    }

    .overlay {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        padding: 20px;
        background: linear-gradient(to top, rgba(0, 0, 0, 0.85), transparent);
        opacity: 0;
        transform: translateY(40px);
        transition: all 0.5s ease;
    }

    .card1:hover .overlay {
        opacity: 1;
        transform: translateY(0);
    }

    .overlay h3 {
        margin: 0 0 8px;
        font-size: 18px;
        font-weight: bold;
    }

    .overlay p {
        margin: 0 0 12px;
        font-size: 14px;
        line-height: 1.4;
        color: #d1d5db;
    }

    .overlay button {
        padding: 6px 12px;
        border: none;
        border-radius: 6px;
        background: #3b82f6;
        color: #fff;
        font-size: 14px;
        cursor: pointer;
        transition: background 0.3s ease;
    }

    .overlay button:hover {
        background: #2563eb;
    }

    .card1.active {
        transform: scale(1) rotateY(0deg);
        box-shadow: 0 12px 25px rgba(0, 0, 0, 0.4);
    }

    .card1.prev {
        transform: scale(0.9) rotateY(15deg);
    }

    .card1.next {
        transform: scale(0.9) rotateY(-15deg);
    }
</style>
{% endblock %}

{% block content %}
<!-- Floating Search Bar -->


<!-- Hero Section -->
<section class="hero-section">
    <!-- Background Video -->
    <!-- Replace this in your hero-section -->
    <video autoplay muted loop playsinline preload="none" class="hero-video">
        <source src="{% static 'assets/video/hero-bg.mp4' %}" type="video/mp4">
        <source src="{% static 'assets/video/hero-bg.webm' %}" type="video/webm">
        Your browser does not support the video tag.
    </video>

    <!-- Gradient Overlay -->
    <div class="overlay"></div>

    <!-- Content -->
    <div class="container position-relative">
        <div class="row align-items-center min-vh-75">
            <div class="col-lg-6">
                <h1 class="display-3 fw-bold mb-4">Explore India</h1>
                <p class="lead mb-5">
                    Plan perfect trips with detailed itineraries, budget management, and instant invoice generation
                </p>
                <div class="d-flex gap-3 justify-content-center flex-wrap">
                    <a href="{% url 'home:login' %}" class="btn btn-light btn-lg px-4 py-2">
                        <i class="fas fa-rocket me-2"></i>Start Planning
                    </a>
                    <a href="#states" class="btn btn-outline-light btn-lg px-4 py-2">
                        <i class="fas fa-compass me-2"></i>Explore Destinations
                    </a>
                </div>
            </div>
            <div class="col-lg-6">

                <div class="carousel-container" id="carouselContainer" style="height: 70vh; align-content: center;">

                    <div class="carousel" id="carousel">
                        <div class="card active">
                            <img src="{% static 'assets/images/delhi.jpg' %}" alt="Delhi">
                            <h3>New Delhi, India</h3>
                            <p>Delhi is the capital of India, known for its history and culture.</p>
                        </div>
                        <div class="card">
                            <img src="{% static 'assets/images/mumbai.jpg' %}" alt="Mumbai">
                            <h3>Mumbai, India</h3>
                            <p>Mumbai is the capital of Maharashtra and a major trading port.</p>
                        </div>
                        <div class="card">
                            <img src="{% static 'assets/images/goa.jpg' %}" alt="Goa">
                            <h3>Goa, India</h3>
                            <p>Goa is famous for its beaches, nightlife, and Portuguese heritage.</p>
                        </div>
                        <div class="card">
                            <img src="{% static 'assets/images/bangalore.jpg' %}" alt="Bangalore">
                            <h3>Bangalore, India</h3>
                            <p>Known as the Silicon Valley of India for its IT industry.</p>
                        </div>
                        <div class="card">
                            <img src="{% static 'assets/images/kolkata.jpg' %}" alt="Kolkata">
                            <h3>Kolkata, India</h3>
                            <p>Cultural capital of India with colonial architecture.</p>
                        </div>
                    </div>

                    <!-- <div class="indicators" id="indicators"></div> -->

                    <div style="display: flex; justify-content: center;">
                        <button class="control-btn" id="playPauseBtn">❚❚</button>
                    </div>
                </div>


            </div>
        </div>
    </div>
</section>

<section class="py-5 bg-white">
    <div class="container">
        <h2 class="fw-bold mb-3">Most loved Places by travellers </h2>
        <div class="carousel1" id="carousel1">
            <div class="track" id="track">
                <div class="card1">
                    <img src="https://picsum.photos/id/1018/600/400" alt="">
                    <div class="overlay">
                        <h3>Mountain Escape</h3>
                        <p>Experience the serenity of the mountains with breathtaking views and fresh air.</p>
                        <button>Explore</button>
                    </div>
                </div>
                <div class="card1">
                    <img src="https://picsum.photos/id/1025/600/400" alt="">
                    <div class="overlay">
                        <h3>Wildlife Safari</h3>
                        <p>Get closer to nature and discover exotic wildlife in their natural habitat.</p>
                        <button>Book Now</button>
                    </div>
                </div>
                <div class="card1">
                    <img src="https://picsum.photos/id/1043/600/400" alt="">
                    <div class="overlay">
                        <h3>City Lights</h3>
                        <p>Explore the nightlife, skyscrapers, and vibrant culture of the big city.</p>
                        <button>Discover</button>
                    </div>
                </div>
                <div class="card1">
                    <img src="https://picsum.photos/id/1039/600/400" alt="">
                    <div class="overlay">
                        <h3>Beach Paradise</h3>
                        <p>Relax on sandy shores, swim in turquoise waters, and enjoy tropical vibes.</p>
                        <button>Relax</button>
                    </div>
                </div>
                <div class="card1">
                    <img src="https://picsum.photos/id/1050/600/400" alt="">
                    <div class="overlay">
                        <h3>Adventure Trails</h3>
                        <p>Hike through forests and discover hidden gems along adventurous trails.</p>
                        <button>Join Tour</button>
                    </div>
                </div>
                <div class="card1">
                    <img src="https://picsum.photos/id/1005/600/400" alt="">
                    <div class="overlay">
                        <h3>Cultural Journey</h3>
                        <p>Immerse yourself in rich traditions, food, and art from around the world.</p>
                        <button>Learn More</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- Statistics Section -->
<section class="bg-white achivement-section">
    <div class="container achivement-path-vector py-5">
        <div class="row text-center">
            <div class="col-md-3 col-6 mb-4 d-flex justify-content-center">
                <div class="achivements-count-div">
                    <div class="stat-number" id="statDestinations">0</div>
                    <p class="text-muted">Destinations</p>
                </div>

            </div>
            <div class="col-md-3 col-6 mb-4 d-flex justify-content-center">
                <div class="achivements-count-div">
                    <div class="stat-number" id="statTrips">0</div>
                    <p class="text-muted">Trips Planned</p>
                </div>
            </div>
            <div class="col-md-3 col-6 mb-4 d-flex justify-content-center">
                <div class="achivements-count-div">
                    <div class="stat-number" id="statHappy">0</div>
                    <p class="text-muted">Happy Travelers</p>
                </div>
            </div>
            <div class="col-md-3 col-6 mb-4 d-flex justify-content-center">
                <div class="achivements-count-div">
                    <div class="stat-number">24/7</div>
                    <p class="text-muted">Support</p>
                </div>
            </div>
        </div>
</section>
<section class="stefi-different-section py-5 bg-white">

    <div class="container">
        <h1 class="text-center fw-bold">What Makes STEFI Different</h1>
        <div class="card2s py-5">
            <div class="card2">
                <i class="fas fa-calendar-alt fa-xl mb-4"></i>
                <h3>Detailed Itineraries</h3>
                <p>Create hour-by-hour plans with activities, timings, and locations</p>
            </div>
            <div class="card2">
                <i class="fas fa-calculator fa-xl mb-4"></i>
                <h3>Budget Management</h3>
                <p>Track expenses and manage your travel budget effectively</p>
            </div>
            <div class="card2">
                <i class="fas fa-file-invoice fa-xl mb-4"></i>
                <h3>Instant Invoices</h3>
                <p>Generate professional invoices for your trips and expenses</p>
            </div>
        </div>
    </div>
</section>
<!-- States Carousel Section -->
<!-- <section id="states" class="state-carousel py-5 bg-light">
    <div class="container">
        <div class="text-center mb-5">
            <h2 class="fw-bold">Explore by State</h2>
            <p class="text-muted">Discover amazing destinations across India</p>
        </div>

        <div class="row" id="statesContainer">
            <div class="col-12 text-center">
                <div class="loading-spinner mx-auto"></div>
                <p class="text-muted mt-2">Loading states...</p>
            </div>
        </div>

        <div class="text-center mt-4">
            <a href="#" class="btn btn-primary">
                <i class="fas fa-globe-asia me-2"></i>View All States
            </a>
        </div>
    </div>
</section> -->

<!-- Popular Destinations Section -->
<!-- <section class="py-5 bg-white">
    <div class="container">
        <div class="text-center mb-5">
            <h2 class="fw-bold">Popular Destinations</h2>
            <p class="text-muted">Most loved places by travelers</p>
        </div>

        <div class="row" id="destinationsContainer">
            <div class="col-12 text-center">
                <div class="loading-spinner mx-auto"></div>
                <p class="text-muted mt-2">Loading destinations...</p>
            </div>
        </div>
    </div>
</section> -->

<!-- Features Section -->
<!-- <section id="features" class="py-5 bg-light">
    <div class="container">
        <div class="text-center mb-5">
            <h2 class="fw-bold">Why Choose Stefi?</h2>
            <p class="text-muted">Everything you need for perfect trip planning</p>
        </div>

        <div class="row">
            <div class="col-md-4 mb-4">
                <div class="text-center">
                    <div class="feature-icon">
                        <i class="fas fa-route fa-2x text-white"></i>
                    </div>
                    <h4>Detailed Itineraries</h4>
                    <p class="text-muted">Create hour-by-hour plans with activities, timings, and locations</p>
                </div>
            </div>
            <div class="col-md-4 mb-4">
                <div class="text-center">
                    <div class="feature-icon">
                        <i class="fas fa-calculator fa-2x text-white"></i>
                    </div>
                    <h4>Budget Management</h4>
                    <p class="text-muted">Track expenses and manage your travel budget effectively</p>
                </div>
            </div>
            <div class="col-md-4 mb-4">
                <div class="text-center">
                    <div class="feature-icon">
                        <i class="fas fa-file-invoice-dollar fa-2x text-white"></i>
                    </div>
                    <h4>Instant Invoices</h4>
                    <p class="text-muted">Generate professional invoices for your trips and expenses</p>
                </div>
            </div>
        </div>
    </div>
</section> -->
<!-- Trip Selection Modal -->
<div class="modal fade" id="tripSelectionModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Select Trip</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="tripSelectionContent">
                <!-- Content will be loaded here -->
            </div>
        </div>
    </div>
</div>
<!-- Destination Selection Modal -->
<div class="modal fade" id="destinationSelectionModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Select Destination</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="destinationSelectionContent">
            </div>
        </div>
    </div>
</div>

<!-- CTA Section -->
<!-- <section class="py-5 bg-primary text-white"
    style="background-color: rgb(11 162 192) !important;margin: 10px;border-radius: 26px;">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-8">
                <h2 class="fw-bold mb-3">Ready to Plan Your Adventure?</h2>
                <p class="lead mb-0">Join thousands of travelers who trust Stefi for their trip planning needs</p>
            </div>
            <div class="col-lg-4 text-lg-end">
                <a href="{% url 'home:login' %}" class="btn btn-light btn-lg px-4">
                    <i class="fas fa-user-plus me-2"></i>Get Started
                </a>
            </div>
        </div>
    </div>
</section> -->
{% endblock %}

{% block extra_js %}
<script>
    function showToast(title, message, type = 'info') {
        const toast = document.createElement('div');
        toast.className = `toast align-items-center text-white bg-${type} border-0`;
        toast.innerHTML = `
        <div class="d-flex">
            <div class="toast-body">
                <strong>${title}:</strong> ${message}
            </div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
        </div>
    `;

        document.body.appendChild(toast);
        const bsToast = new bootstrap.Toast(toast);
        bsToast.show();

        // Remove toast after it's hidden
        toast.addEventListener('hidden.bs.toast', () => {
            document.body.removeChild(toast);
        });
    }
    function showTripSelectionModal(destinationId, destinationName) {
        // Simulate loading user trips (replace with actual API call)
        const userTrips = [
            { id: 1, name: "Summer Vacation", destination: "Goa", date: "Aug 15-20, 2024" },
            { id: 2, name: "Business Trip", destination: "Delhi", date: "Sep 1-5, 2024" },
            { id: 3, name: "Family Holiday", destination: "Manali", date: "Dec 20-28, 2024" }
        ];

        let tripsHtml = '';
        if (userTrips.length === 0) {
            tripsHtml = `
            <div class="text-center py-4">
                <i class="fas fa-suitcase fa-3x text-muted mb-3"></i>
                <h6>No trips found</h6>
                <p class="text-muted">You don't have any active trips yet.</p>
                <button class="btn btn-primary" onclick="startNewTrip('${destinationId}', '${destinationName}')">
                    Create New Trip
                </button>
            </div>
        `;
        } else {
            tripsHtml = `
            <h6 class="mb-3">Select a trip to add ${destinationName}:</h6>
            <div class="trip-list">
        `;

            userTrips.forEach(trip => {
                tripsHtml += `
                <div class="trip-item card mb-2 hover-lift" onclick="addDestinationToTrip('${destinationId}', '${trip.id}')">
                    <div class="card-body">
                        <h6 class="card-title mb-1">${trip.name}</h6>
                        <p class="card-text text-muted small mb-1">${trip.destination}</p>
                        <p class="card-text text-muted small mb-0">${trip.date}</p>
                    </div>
                </div>
            `;
            });

            tripsHtml += `</div>`;
        }

        $('#tripSelectionContent').html(tripsHtml);

        const modal = new bootstrap.Modal(document.getElementById('tripSelectionModal'));
        modal.show();
    }

    function addDestinationToTrip(destinationId, tripId) {
        console.log('Adding destination to trip:', destinationId, tripId);

        // Close the modal
        $('#tripSelectionModal').modal('hide');

        showToast('Success', 'Destination added to your trip', 'success');

        // Redirect to trip detail page
        setTimeout(() => {
            window.location.href = `/trips/${tripId}/`;
        }, 1000);
    }
    function startNewTrip(destinationId, destinationName) {
        console.log('Starting new trip to:', destinationName);

        // Close the modal
        $('#destinationSelectionModal').modal('hide');

        // Show success message
        showToast('Success', `Starting new trip to ${destinationName}`, 'success');

        // Redirect to trip creation page after a short delay
        setTimeout(() => {
            window.location.href = `/trips/create/?destination=${encodeURIComponent(destinationName)}`;
        }, 1000);
    }

    function addToExistingTrip(destinationId, destinationName) {
        console.log('Adding to existing trip:', destinationName);

        // Close the modal
        $('#destinationSelectionModal').modal('hide');

        // Show trip selection modal
        showTripSelectionModal(destinationId, destinationName);
    }

    function addToWishlist(destinationId) {
        console.log('Adding to wishlist:', destinationId);
        showToast('Added to Wishlist', 'Destination saved to your wishlist', 'success');
    }

    function viewDestinationDetails(destinationId) {
        console.log('Viewing details for:', destinationId);
        window.location.href = `/destinations/${destinationId}/`;
    }

    function shareDestination(destinationId) {
        console.log('Sharing destination:', destinationId);

        if (navigator.share) {
            navigator.share({
                title: 'Amazing Destination',
                text: 'Check out this beautiful destination I found!',
                url: window.location.origin + '/destinations/' + destinationId + '/'
            });
        } else {
            showToast('Share', 'Copy the link to share', 'info');
        }
    }
    function showDestinationSelection(destination) {
        // Hide search results
        searchResults.hide();

        // Create selection content
        const selectionContent = `
        <div class="destination-selection">
            <!-- Destination Header -->
            <div class="destination-header text-center mb-4">
                <img src="${destination.image_url}" alt="${destination.name}" 
                     class="destination-main-image rounded-3 mb-3" style="height: 200px; width: 100%; object-fit: cover;">
                <h3 class="mb-2">${destination.name}</h3>
                <p class="text-muted mb-3">
                    <i class="fas fa-map-marker-alt me-1"></i>${destination.state}
                    <span class="mx-2">•</span>
                    ${destination.type}
                </p>
            </div>

            <!-- Trip Options -->
            <div class="trip-options mb-4">
                <h6 class="mb-3">How would you like to proceed?</h6>
                <div class="row g-3">
                    <div class="col-md-6">
                        <div class="option-card text-center p-4 rounded-3 border hover-lift" 
                             onclick="startNewTrip('${destination.id}', '${destination.name}')">
                            <div class="option-icon bg-primary rounded-circle p-3 mb-3 mx-auto">
                                <i class="fas fa-plus text-white fa-2x"></i>
                            </div>
                            <h6 class="mb-2">Plan New Trip</h6>
                            <p class="text-muted small mb-0">Create a new trip to ${destination.name}</p>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="option-card text-center p-4 rounded-3 border hover-lift" 
                             onclick="addToExistingTrip('${destination.id}', '${destination.name}')">
                            <div class="option-icon bg-success rounded-circle p-3 mb-3 mx-auto">
                                <i class="fas fa-suitcase text-white fa-2x"></i>
                            </div>
                            <h6 class="mb-2">Add to Existing Trip</h6>
                            <p class="text-muted small mb-0">Add this destination to one of your current trips</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="quick-actions mb-4">
                <h6 class="mb-3">Quick Actions</h6>
                <div class="d-flex flex-wrap gap-2">
                    <button class="btn btn-outline-primary btn-sm" onclick="addToWishlist('${destination.id}')">
                        <i class="fas fa-heart me-1"></i>Save to Wishlist
                    </button>
                    <button class="btn btn-outline-secondary btn-sm" onclick="viewDestinationDetails('${destination.id}')">
                        <i class="fas fa-info-circle me-1"></i>View Details
                    </button>
                    <button class="btn btn-outline-info btn-sm" onclick="shareDestination('${destination.id}')">
                        <i class="fas fa-share me-1"></i>Share
                    </button>
                </div>
            </div>

            <!-- Recent Activities (if any) -->
            <div class="recent-activities">
                <h6 class="mb-3">Recent Visitor Activities</h6>
                <div class="activity-stats">
                    <div class="row text-center">
                        <div class="col-4">
                            <div class="stat">
                                <div class="stat-number text-primary">124</div>
                                <div class="stat-label small">Trips Planned</div>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="stat">
                                <div class="stat-number text-success">4.8</div>
                                <div class="stat-label small">Average Rating</div>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="stat">
                                <div class="stat-number text-info">89%</div>
                                <div class="stat-label small">Recommend</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `;

        // Load content into modal
        $('#destinationSelectionContent').html(selectionContent);

        // Show modal
        const modal = new bootstrap.Modal(document.getElementById('destinationSelectionModal'));
        modal.show();

        // Add hover effects
        $('.option-card').hover(
            function () {
                $(this).css('transform', 'translateY(-3px)');
                $(this).css('border-color', 'var(--primary-color)');
            },
            function () {
                $(this).css('transform', 'translateY(0)');
                $(this).css('border-color', '#dee2e6');
            }
        );
    }

    function renderDestinations(destinations) {
        let html = '';
        destinations.forEach(dest => {
            console.log(dest);
            html += `
                <div class="col-xl-3 col-lg-4 col-md-6 mb-4">
                    <div class="destination-card card shadow-sm">
                        <div class="position-relative">
                            <img src="${dest.image_url}" class="destination-image card-img-top" alt="${dest.name}">
                            <span class="badge badge-destination">${dest.type}</span>
                        </div>
                        <div class="card-body">
                            <h5 class="card-title">${dest.name}</h5>
                            <p class="card-text text-muted small">
                                <i class="fas fa-map-marker-alt me-1"></i>
                                ${dest.state}
                            </p>
                            <p class="card-text">${dest.description}</p>
                            <div class="d-flex justify-content-between align-items-center">
                                <span class="badge bg-info">
                                    <i class="fas fa-star me-1"></i>Popular
                                </span>
                                <a href="${dest.url}" class="btn btn-sm btn-primary">Plan Trip</a>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        });

        $('#destinationsContainer').html(html);
    }
    const searchInput = $('#globalSearch');
    function displaySearchResults(results) {
        if (results.length === 0) {
            searchResults.html(`
            <div class="search-result-item">
                <div class="text-center text-muted py-4">
                    <i class="fas fa-search fa-2x mb-3"></i>
                    <h6>No destinations found</h6>
                    <p class="small">Try different search terms or browse all destinations</p>
                </div>
            </div>
        `).show();
            return;
        }

        let html = '';
        results.forEach(result => {
            html += `
            <div class="search-result-item" data-destination='${JSON.stringify(result)}'>
                <div class="d-flex align-items-center">
                    <img src="${result.image_url}" alt="${result.name}" 
                         class="rounded me-3" width="50" height="50" style="object-fit: cover;">
                    <div class="flex-grow-1">
                        <h6 class="mb-1">${result.name}</h6>
                        <small class="text-muted">
                            <i class="fas fa-map-marker-alt me-1"></i>${result.state}
                            <span class="mx-2">•</span>
                            ${result.type}
                        </small>
                    </div>
                    <div class="ms-3">
                        <i class="fas fa-chevron-right text-muted"></i>
                    </div>
                </div>
            </div>
        `;
        });

        searchResults.html(html).show();

        // Add click handler for destination selection
        $('.search-result-item').on('click', function () {
            const destination = $(this).data('destination');
            showDestinationSelection(destination);
        });
    }



    const searchResults = $('#searchResults');

    $(document).ready(function () {
        // Initialize counters with animation
        function animateCounter(element, target) {
            let current = 0;
            const increment = target / 100;
            const timer = setInterval(() => {
                current += increment;
                if (current >= target) {
                    clearInterval(timer);
                    element.text(target.toLocaleString());
                } else {
                    element.text(Math.floor(current).toLocaleString());
                }
            }, 20);
        }

        // Animate statistics
        setTimeout(() => {
            animateCounter($('#statDestinations'), 500);
            animateCounter($('#statTrips'), 10000);
            animateCounter($('#statHappy'), 95);
        }, 1000);

        // Floating search bar behavior
        const searchContainer = $('.floating-search-container');
        $(window).scroll(function () {
            if ($(this).scrollTop() > 100) {
                searchContainer.addClass('scrolled');
            } else {
                searchContainer.removeClass('scrolled');
            }
        });

        // Load states via API

        // Load popular destinations via API



        // Load data on page load
        loadStates();
        loadPopularDestinations();

        // Search functionality (using API)
        let searchTimeout;

        searchInput.on('input', function () {
            const query = $(this).val().trim();

            clearTimeout(searchTimeout);

            if (query.length < 2) {
                searchResults.hide().empty();
                return;
            }

            searchTimeout = setTimeout(() => {
                performSearch(query);
            }, 300);
        });



        // Hide results when clicking outside
        $(document).on('click', function (e) {
            if (!$(e.target).closest('.floating-search-container').length) {
                searchResults.hide();
            }
        });
    });


    // Define API URLs using Django template tags
    const API_URLS = {
        search: "{% url 'home:api_search' %}",
        states: "{% url 'home:api_states' %}",
        popularDestinations: "{% url 'home:api_popular_destinations' %}",
        destinationTypes: "{% url 'home:api_destination_types' %}"
    };

    function renderStates(states) {
        let html = '';
        states.forEach(state => {
            html += `
                <div class="col-xl-3 col-lg-4 col-md-6 mb-4">
                    <div class="state-card card shadow-sm">
                        <div class="position-relative">
                            <img src="${state.image_url}" class="state-image card-img-top" alt="${state.name}">
                            <div class="state-overlay">
                                <h5 class="card-title mb-0">${state.name}</h5>
                                <small>${state.destination_count} destinations</small>
                            </div>
                        </div>
                        <div class="card-body">
                            <p class="card-text text-muted small">${state.description}</p>
                            <a href="${state.url}" class="btn btn-sm btn-outline-primary">Explore ${state.code}</a>
                        </div>
                    </div>
                </div>
            `;
        });

        $('#statesContainer').html(html);

        // Add hover effects
        $('.state-card').hover(
            function () {
                $(this).find('.state-overlay').css('background', 'linear-gradient(transparent, var(--primary-color))');
            },
            function () {
                $(this).find('.state-overlay').css('background', 'linear-gradient(transparent, rgba(0, 0, 0, 0.8))');
            }
        );
    }

    // Load states via API
    function loadStates() {
        $.ajax({
            url: API_URLS.states,
            type: 'GET',
            success: function (response) {
                console.log(response);
                if (response.success) {
                    renderStates(response.states);
                } else {
                    $('#statesContainer').html(`
                    <div class="col-12 text-center">
                        <i class="fas fa-exclamation-triangle fa-2x text-warning mb-3"></i>
                        <p class="text-muted">Failed to load states. Please try again.</p>
                    </div>
                `);
                }
            },
            error: function () {
                $('#statesContainer').html(`
                <div class="col-12 text-center">
                    <i class="fas fa-exclamation-triangle fa-2x text-danger mb-3"></i>
                    <p class="text-muted">Error loading states. Please refresh the page.</p>
                </div>
            `);
            }
        });
    }

    // Load popular destinations via API
    function loadPopularDestinations() {
        $.ajax({
            url: API_URLS.popularDestinations,
            type: 'GET',
            success: function (response) {
                console.log("response", response);
                if (response.success) {
                    renderDestinations(response.destinations);
                } else {
                    $('#destinationsContainer').html(`
                    <div class="col-12 text-center">
                        <i class="fas fa-exclamation-triangle fa-2x text-warning mb-3"></i>
                        <p class="text-muted">Failed to load destinations.</p>
                    </div>
                `);
                }
            },
            error: function () {
                $('#destinationsContainer').html(`
                <div class="col-12 text-center">
                    <i class="fas fa-exclamation-triangle fa-2x text-danger mb-3"></i>
                    <p class="text-muted">Error loading destinations.</p>
                </div>
            `);
            }
        });
    }

    // Search functionality
    function performSearch(query) {
        showLoading(searchInput);

        $.ajax({
            url: API_URLS.search,
            type: 'GET',
            data: { q: query },
            success: function (response) {
                hideLoading(searchInput);

                if (response.success) {
                    displaySearchResults(response.results);
                } else {
                    searchResults.html(`
                    <div class="search-result-item">
                        <div class="text-center text-muted py-3">
                            ${response.message}
                        </div>
                    </div>
                `).show();
                }
            },
            error: function () {
                hideLoading(searchInput);
                searchResults.html(`
                <div class="search-result-item">
                    <div class="text-center text-danger py-3">
                        <i class="fas fa-exclamation-circle me-2"></i>
                        Search failed. Please try again.
                    </div>
                </div>
            `).show();
            }
        });
    }
</script>

<script>
    let currentIndex = 0;
    let autoScrollInterval;
    let isPlaying = true;
    let isDragging = false;
    let startPosition = 0;
    let currentTranslate = 0;
    let prevTranslate = 0;
    let animationID = 0;
    let velocity = 0;
    let lastTime = 0;
    let lastPosition = 0;

    const carouselContainer = document.getElementById("carouselContainer");
    const carousel = document.getElementById("carousel");
    const cards = Array.from(document.querySelectorAll(".card")); // original cards
    //   const indicatorsContainer = document.getElementById("indicators");
    const playPauseBtn = document.getElementById("playPauseBtn");

    // Clone first and last cards
    const firstClone = cards[0].cloneNode(true);
    const lastClone = cards[cards.length - 1].cloneNode(true);
    firstClone.id = "first-clone";
    lastClone.id = "last-clone";

    carousel.appendChild(firstClone);
    carousel.insertBefore(lastClone, carousel.firstChild);

    let allCards = document.querySelectorAll(".card"); // includes clones
    let cardWidth = cards[0].offsetWidth + 30;

    // Create indicators
    //   cards.forEach((_, i) => {
    // const indicator = document.createElement("div");
    // indicator.classList.add("indicator");
    // if (i === 0) indicator.classList.add("active");
    // indicator.addEventListener("click", () => {
    //   currentIndex = i;
    //   updateCarousel();
    //   resetAutoScroll();
    // });
    // indicatorsContainer.appendChild(indicator);
    //   });

    //   const indicators = document.querySelectorAll(".indicator");

    // Update carousel position
    function updateCarousel(animate = true) {
        // Reset all cards (including clones)
        allCards.forEach((card) => {
            card.classList.remove("active", "left", "right", "hidden");
        });

        // Apply positions only on real cards
        cards.forEach((card, index) => {
            if (index === currentIndex) {
                card.classList.add("active");
            } else if (index === (currentIndex - 1 + cards.length) % cards.length) {
                card.classList.add("left");
            } else if (index === (currentIndex + 1) % cards.length) {
                card.classList.add("right");
            } else {
                card.classList.add("hidden");
            }

            card.style.transition = animate
                ? "transform 0.6s ease, opacity 0.6s ease"
                : "none";
        });

        // Update indicators
        //   indicators.forEach((indicator, index) => {
        //     indicator.classList.toggle("active", index === currentIndex);
        //   });
    }

    // Handle infinite loop snap
    function handleTransitionEnd() {
        if (allCards[currentIndex + 1].id === "first-clone") {
            carousel.style.transition = "none";
            currentIndex = 0;
            updateCarousel(false);
        }
        if (allCards[currentIndex + 1].id === "last-clone") {
            carousel.style.transition = "none";
            currentIndex = cards.length - 1;
            updateCarousel(false);
        }
    }

    carousel.addEventListener("transitionend", handleTransitionEnd);

    // Drag/swipe
    const touchStart = (event) => {
        stopAutoScroll();
        startPosition = getPositionX(event);
        isDragging = true;
        animationID = requestAnimationFrame(animation);

        carousel.classList.add("grabbing");
        carousel.style.transition = "none";
        allCards.forEach((card) => card.classList.add("dragging"));
    };

    const touchMove = (event) => {
        if (!isDragging) return;

        const currentPosition = getPositionX(event);
        currentTranslate = prevTranslate + currentPosition - startPosition;

        const currentTime = Date.now();
        const timeDiff = currentTime - lastTime;

        if (timeDiff > 0) {
            velocity = (currentPosition - lastPosition) / timeDiff;
            lastTime = currentTime;
            lastPosition = currentPosition;
        }

        // carousel.style.transform = `translateX(${currentTranslate}px)`;
    };

    const touchEnd = () => {
        if (!isDragging) return;

        isDragging = false;
        cancelAnimationFrame(animationID);

        carousel.classList.remove("grabbing");
        allCards.forEach((card) => card.classList.remove("dragging"));

        const momentum = velocity * 200;
        let swipeDistance = currentTranslate - prevTranslate;
        swipeDistance += momentum;

        const cardWidth = cards[0].offsetWidth + 30;

        if (Math.abs(swipeDistance) > cardWidth / 3 || Math.abs(velocity) > 0.5) {
            if (swipeDistance > 0 || velocity > 0) {
                currentIndex = (currentIndex - 1 + cards.length) % cards.length;
            } else {
                currentIndex = (currentIndex + 1) % cards.length;
            }
        }

        updateCarousel();
        velocity = 0;
        lastTime = 0;
        lastPosition = 0;

        if (isPlaying) resetAutoScroll();
    };

    const getPositionX = (event) => {
        return event.type.includes("mouse")
            ? event.pageX
            : event.touches[0].clientX;
    };

    const animation = () => {
        if (isDragging) {
            requestAnimationFrame(animation);
        }
    };

    // Event listeners
    carousel.addEventListener("mousedown", touchStart);
    carousel.addEventListener("touchstart", touchStart);

    carousel.addEventListener("mousemove", touchMove);
    carousel.addEventListener("touchmove", touchMove);

    carousel.addEventListener("mouseup", touchEnd);
    carousel.addEventListener("mouseleave", touchEnd);
    carousel.addEventListener("touchend", touchEnd);

    // Auto-scroll
    function startAutoScroll() {
        autoScrollInterval = setInterval(() => {
            currentIndex = (currentIndex + 1) % cards.length;
            updateCarousel();
        }, 3000);
    }

    function stopAutoScroll() {
        clearInterval(autoScrollInterval);
    }

    function resetAutoScroll() {
        stopAutoScroll();
        if (isPlaying) startAutoScroll();
    }

    // Play/Pause
    playPauseBtn.addEventListener("click", () => {
        isPlaying = !isPlaying;
        if (isPlaying) {
            startAutoScroll();
            playPauseBtn.innerHTML = "❚❚";
        } else {
            stopAutoScroll();
            playPauseBtn.innerHTML = "►";
        }
    });

    // Keyboard navigation
    document.addEventListener("keydown", (e) => {
        if (e.key === "ArrowLeft") {
            currentIndex = (currentIndex - 1 + cards.length) % cards.length;
            updateCarousel();
            resetAutoScroll();
        } else if (e.key === "ArrowRight") {
            currentIndex = (currentIndex + 1) % cards.length;
            updateCarousel();
            resetAutoScroll();
        } else if (e.key === " ") {
            isPlaying = !isPlaying;
            if (isPlaying) {
                startAutoScroll();
                playPauseBtn.innerHTML = "❚❚";
            } else {
                stopAutoScroll();
                playPauseBtn.innerHTML = "►";
            }
            e.preventDefault();
        }
    });

    // Initial setup
    function initialPosition() {
        const containerWidth = carouselContainer.offsetWidth;
        const centerOffset = (containerWidth - cardWidth) / 2;
        const startTransform = -((currentIndex + 1) * cardWidth) + centerOffset;
        // carousel.style.transform = `translateX(${startTransform}px)`;
        prevTranslate = startTransform;
    }

    currentIndex = 0; // start at first real card
    updateCarousel(false);
    initialPosition();
    startAutoScroll();

    // Resize handling
    window.addEventListener("resize", () => {
        cardWidth = cards[0].offsetWidth + 30;
        updateCarousel(false);
    });
</script>

<script>
    const carousel1El = document.getElementById("carousel1");
    const trackEl = document.getElementById("track");
    let cards1 = document.querySelectorAll(".card1");
    const cardCount1 = cards1.length;
    let index1 = 0;
    let interval1;

    let isDragging1 = false;
    let startX1 = 0;
    let currentTranslate1 = 0;
    let prevTranslate1 = 0;
    let animationID1;

    // Clone 3 cards for infinite loop
    for (let i = 0; i < 3; i++) {
        let clone = cards1[i].cloneNode(true);
        trackEl.appendChild(clone);
    }

    function autoScroll1() {
        index1++;
        const step = carousel1El.offsetWidth / 3;
        trackEl.style.transition = "transform 0.8s cubic-bezier(.25,.8,.25,1)";
        trackEl.style.transform = `translateX(-${step * index1}px)`;

        if (index1 >= cardCount1) {
            setTimeout(() => {
                trackEl.style.transition = "none";
                trackEl.style.transform = "translateX(0)";
                index1 = 0;
            }, 850);
        }
    }

    function startAutoScroll1() {
        interval1 = setInterval(autoScroll1, 3000);
    }

    function stopAutoScroll1() {
        clearInterval(interval1);
    }

    // Grab/Drag functionality
    const getPositionX1 = e =>
        e.type.includes("mouse") ? e.pageX : e.touches[0].clientX;

    const dragStart1 = e => {
        stopAutoScroll1();
        isDragging1 = true;
        startX1 = getPositionX1(e);
        animationID1 = requestAnimationFrame(animation1);
        carousel1El.classList.add("grabbing");
    };

    const dragMove1 = e => {
        if (!isDragging1) return;
        const currentX = getPositionX1(e);
        currentTranslate1 = prevTranslate1 + currentX - startX1;
    };

    const dragEnd1 = () => {
        cancelAnimationFrame(animationID1);
        isDragging1 = false;
        const movedBy = currentTranslate1 - prevTranslate1;
        const step = carousel1El.offsetWidth / 3;

        if (movedBy < -100) index1++;
        if (movedBy > 100) index1--;

        moveToIndex1();
        startAutoScroll1();
        carousel1El.classList.remove("grabbing");
    };

    function animation1() {
        setSliderPosition1();
        if (isDragging1) requestAnimationFrame(animation1);
    }

    function setSliderPosition1() {
        trackEl.style.transform = `translateX(${currentTranslate1}px)`;
    }

    function moveToIndex1() {
        const step = carousel1El.offsetWidth / 3;
        currentTranslate1 = -index1 * step;
        prevTranslate1 = currentTranslate1;
        trackEl.style.transition = "transform 0.5s ease-out";
        trackEl.style.transform = `translateX(${currentTranslate1}px)`;
    }

    // Events
    carousel1El.addEventListener("mousedown", dragStart1);
    carousel1El.addEventListener("mousemove", dragMove1);
    carousel1El.addEventListener("mouseup", dragEnd1);
    carousel1El.addEventListener("mouseleave", () => isDragging1 && dragEnd1());

    carousel1El.addEventListener("touchstart", dragStart1);
    carousel1El.addEventListener("touchmove", dragMove1);
    carousel1El.addEventListener("touchend", dragEnd1);

    // Init
    startAutoScroll1();
</script>





{% endblock %}
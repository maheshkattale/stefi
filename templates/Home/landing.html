{% extends 'base.html' %}
{% load static %}

{% block title %}Stefi - Plan Your Perfect Trip{% endblock %}

{% block extra_css %}
<link href="{% static 'assets/css/landing-page.css' %}" rel="stylesheet">
<style>
    .achivement-path-vector {
        background:url({% static 'assets/images/achivement-vector-bg.png' %}) no-repeat center center;
        background-size: contain;
    }

    .stefi-different-section {
        background: url(/static/assets/images/mountain.jpg) no-repeat center center;
        margin: 56px;
        border-radius: 26px;
        background-size: cover;
        padding: 0;
    }

    .places-section {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background:url("{% static 'assets/images/places-section.jpeg' %}") no-repeat center center/cover;
        position: relative;
        width: 100%;
    }

    .hero-section {

        background:url("{% static 'assets/images/hero-bg.jpg' %}") no-repeat center center/cover;

    }

    .card {
        text-decoration: none;
        color: white;
        border: none;
    }

    a.card:hover {
        color: #e0e0e0;


    }
</style>
<style>
/* ===== Explore By Experience (Fixed Premium Design) ===== */

.experience-section {
  padding: 70px 0;
  background: #f9fbfd;
}

.experience-header {
  margin-bottom: 45px;
}

.experience-header span {
  font-size: 14px;
  color: #4f7cff;
  font-weight: 600;
  letter-spacing: 1px;
}

.experience-header h2 {
  font-size: 34px;
  font-weight: 800;
  color: #0f172a;
  margin-top: 6px;
}

.experience-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  gap: 15px;
  margin: auto;
}

.experience-card {
  background: #fff;
  border-radius: 18px;
  overflow: hidden;
  box-shadow: 0 10px 25px rgba(0,0,0,0.08);
  transition: 0.35s ease;
  cursor: pointer;
  position: relative;
}

.experience-card:hover {
  transform: translateY(-8px);
  box-shadow: 0 20px 45px rgba(0,0,0,0.15);
}

.experience-img {
  height: 200px;
  overflow: hidden;
}

.experience-img img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.experience-body {
  padding: 18px;
}

.experience-body h4 {
  font-size: 18px;
  font-weight: 700;
  margin-bottom: 6px;
  color: #0f172a;
}

.experience-body p {
  font-size: 13px;
  color: #64748b;
  margin: 0;
}

.experience-icon {
  position: absolute;
  top: 15px;
  right: 15px;
  background: #4f7cff;
  color: #fff;
  font-size: 16px;
  padding: 10px;
  border-radius: 50%;
  box-shadow: 0 8px 20px rgba(79,124,255,0.4);
}
</style>

{% endblock %}
{% block content %}
<section class="hero-section">

    <div class="hero-overlay"></div>

    <div class="hero-content">
        <h3 class="hero-subtitle">EXPLORE INDIA</h3>

        <h1 class="hero-title">
            Enjoy Incredible Rates &
            <br>
            Appealing Packages
        </h1>

        <!-- Put your existing carousel here -->
        <div class="carousel-container" id="carouselContainer"
            style="height: 50vh; align-content: center; margin-top: 0px;">
            <div class="carousel" id="carousel">

                <a class="card active" href="/state/delhi">
                    <img src="{% static 'assets/images/delhi.jpg' %}" alt="Delhi" class="img-fluid">
                    <h3>New Delhi, India</h3>
                    <!-- <p>Delhi is the capital of India, known for its history and culture.</p> -->
                </a>

                <a class="card" href="/state/mumbai">
                    <img src="{% static 'assets/images/mumbai.jpg' %}" alt="Mumbai" class="img-fluid">
                    <h3>Mumbai, India</h3>
                    <!-- <p>Mumbai is the capital of Maharashtra and a major trading port.</p> -->
                </a>

                <a class="card" href="/state/goa">
                    <img src="{% static 'assets/images/goa.jpg' %}" alt="Goa" class="img-fluid">
                    <h3>Goa, India</h3>
                    <!-- <p>Goa is famous for its beaches, nightlife, and Portuguese heritage.</p> -->
                </a>

                <a class="card" href="/state/bangalore">
                    <img src="{% static 'assets/images/bangalore.jpg' %}" alt="Bangalore" class="img-fluid">
                    <h3>Bangalore, India</h3>
                    <!-- <p>Known as the Silicon Valley of India for its IT industry.</p> -->
                </a>

                <a class="card" href="/state/kolkata">
                    <img src="{% static 'assets/images/kolkata.jpg' %}" alt="Kolkata" class="img-fluid">
                    <h3>Kolkata, India</h3>
                    <!-- <p>Cultural capital of India with colonial architecture.</p> -->
                </a>

            </div>

            <div style="display: flex; justify-content: center;">
                <button class="control-btn" id="playPauseBtn">❚❚</button>
            </div>
        </div>
    </div>

</section>

<section class="places-section page-wrapper py-3">
    <div class="places-left">
        <p class="places-subtitle">Enjoy With Your Love Ones</p>
        <h2 class="places-title">Places to Travel</h2>

        <div class="places-controls">
            <button id="pt-prev" class="pt-btn"><i class="fas fa-chevron-left"></i></button>
            <button id="pt-next" class="pt-btn"><i class="fas fa-chevron-right"></i></button>
        </div>
    </div>

    <div class="places-carousel" id="placesCarousel">
        <!-- CARD 1 -->
        <div class="place-card">
            <img src="https://picsum.photos/id/1021/300/380" alt="">
            <div class="place-overlay">
                <h3>Maharashtra</h3>
                <p>
                    Maharashtra is a state in western India, known for its capital
                    Mumbai, a major industrial and financial hub.
                </p>
                <a href="#" class="read-more">Read More</a>
            </div>
        </div>

        <!-- CARD 2 -->
        <div class="place-card">
            <img src="https://picsum.photos/id/1039/300/380" alt="">
            <div class="place-overlay">
                <h3>Delhi</h3>
                <p>
                    Delhi blends ancient monuments, modern markets, cultural heritage
                    and incredible food experiences.
                </p>
                <a href="#" class="read-more">Read More</a>
            </div>
        </div>

        <!-- CARD 3 -->
        <div class="place-card">
            <img src="https://picsum.photos/id/1043/300/380" alt="">
            <div class="place-overlay">
                <h3>Kashmir</h3>
                <p>
                    Kashmir is known for its snow peaks, green valleys, lakes,
                    and breathtaking natural beauty.
                </p>
                <a href="#" class="read-more">Read More</a>
            </div>
        </div>
    </div>
</section>

<section class="nearest-hotel-section page-wrapper">

    <div class="nh-location-wrapper">
        <div id="locationPicker" class="nh-location">
            <i class="fas fa-map-marker-alt"></i>
            <span id="locText">Detecting...</span>
            <i class="fas fa-chevron-down"></i>
        </div>
        <div id="locationSuggestions" class="loc-suggest-box"></div>
    </div>

    <p class="nh-subtitle">Stay With Your Love Ones</p>
    <h2 class="nh-title">Nearest Hotel</h2>

    <!-- TABS -->
    <div class="nh-tabs">
        <button class="nh-tab active" data-filter="hotel"><i class="fas fa-hotel"></i>Hotel</button>
        <button class="nh-tab" data-filter="homestay"><i class="fas fa-home"></i>Homestay</button>
        <button class="nh-tab" data-filter="dorm"><i class="fas fa-bed"></i>Dormitory</button>
        <button class="nh-tab" data-filter="airbnb"><i class="fab fa-airbnb"></i>Airbnb</button>
    </div>

    <!-- GRID -->
    <div class="nh-grid" id="hotelGrid">

        <!-- SAMPLE CARDS (can be dynamically injected later) -->
        <div class="nh-card" data-type="hotel">
            <img src="{%static 'assets/images/hotels/h1.jpg'%}">
            <p class="nh-card-title">Avsa</p>
            <p class="nh-rating">★★★★★</p>
        </div>

        <div class="nh-card" data-type="homestay">
            <img src="{%static 'assets/images/hotels/h2.jpg'%}">
            <p class="nh-card-title">Avsa</p>
            <p class="nh-rating">★★★★☆</p>
        </div>

        <div class="nh-card" data-type="dorm">
            <img src="{%static 'assets/images/hotels/h3.jpg'%}">
            <p class="nh-card-title">Avsa</p>
            <p class="nh-rating">★★★★★</p>
        </div>

        <div class="nh-card" data-type="hotel">
            <img src="{%static 'assets/images/hotels/h4.jpg'%}">
            <p class="nh-card-title">Avsa</p>
            <p class="nh-rating">★★★★☆</p>
        </div>

        <div class="nh-card" data-type="airbnb">
            <img src="{%static 'assets/images/hotels/h5.jpg'%}">
            <p class="nh-card-title">Avsa</p>
            <p class="nh-rating">★★★★★</p>
        </div>

        <div class="nh-card" data-type="homestay">
            <img src="{%static 'assets/images/hotels/h1.jpg'%}">
            <p class="nh-card-title">Avsa</p>
            <p class="nh-rating">★★★★☆</p>
        </div>

    </div>
</section>

<section class="prod-section page-wrapper my-2">
    <div class="prod-header">
        <div>
            <p class="prod-sub">Shop Travel Accessories</p>
            <h3 class="prod-title">Travel Accessories — Rent or Buy</h3>
        </div>

        <div>
            <!-- Category tabs -->
            <div class="prod-tabs" id="prodTabs">
                <button class="prod-tab active" data-filter="all">All</button>
                <button class="prod-tab" data-filter="electronics">Electronics</button>
                <button class="prod-tab" data-filter="camping">Camping & Trekking</button>
                <button class="prod-tab" data-filter="bag">Bag Packing</button>
                <button class="prod-tab" data-filter="others">Others</button>
            </div>
        </div>
    </div>

    <!-- grid -->
    <div class="prod-grid" id="prodGrid">
        <!-- Sample product cards. You can render these from backend or JS -->
        <!-- Product 1: uses uploaded file path as example image -->
        <article class="product-card" data-category="electronics" data-id="p1">
            <div class="product-thumb">
                <img src="{%static 'assets/images/products/p1.jpg'%}" alt="Camera Kit">
                <div class="prod-badge">Electronics</div>
                <button class="view-btn" data-id="p1">View</button>
            </div>

            <div class="product-meta">
                <div class="product-info">
                    <div class="product-title">Pro Camera Kit</div>
                    <div class="product-cat">Mirrorless + Lenses</div>
                    <div class="price-row">
                        <div>
                            <span class="prod-price">₹1,499</span>
                            <span class="prod-old">₹2,199</span>
                        </div>
                        <div class="rating">★ 4.8 <span> (124)</span></div>
                    </div>
                </div>
            </div>
        </article>

        <!-- Product 2 -->
        <article class="product-card" data-category="camping" data-id="p2">
            <div class="product-thumb">
                <img src="{%static 'assets/images/products/p2.jpg'%}" alt="Tent">
                <div class="prod-badge">Camping</div>
                <button class="view-btn" data-id="p2">View</button>
            </div>
            <div class="product-meta">
                <div class="product-info">
                    <div class="product-title">Lightweight 2P Tent</div>
                    <div class="product-cat">4-season, waterproof</div>
                    <div class="price-row">
                        <div><span class="prod-price">₹499</span> <span class="prod-old">₹799</span></div>
                        <div class="rating">★ 4.6 <span> (89)</span></div>
                    </div>
                </div>
            </div>
        </article>

        <!-- Product 3 -->
        <article class="product-card" data-category="bag" data-id="p3">
            <div class="product-thumb">
                <img src="{%static 'assets/images/products/p3.jpg'%}" alt="Backpack">
                <div class="prod-badge">Bag Packing</div>
                <button class="view-btn" data-id="p3">View</button>
            </div>
            <div class="product-meta">
                <div class="product-info">
                    <div class="product-title">Carry-On Travel Backpack</div>
                    <div class="product-cat">35L, anti-theft</div>
                    <div class="price-row">
                        <div><span class="prod-price">₹899</span> <span class="prod-old">₹1,399</span></div>
                        <div class="rating">★ 4.7 <span> (203)</span></div>
                    </div>
                </div>
            </div>
        </article>

        <!-- Product 4 -->
        <article class="product-card" data-category="electronics" data-id="p4">
            <div class="product-thumb">
                <img src="{%static 'assets/images/products/p4.jpg'%}" alt="Powerbank">
                <div class="prod-badge">Electronics</div>
                <button class="view-btn" data-id="p4">View</button>
            </div>
            <div class="product-meta">
                <div class="product-info">
                    <div class="product-title">High-Capacity Powerbank</div>
                    <div class="product-cat">20000mAh</div>
                    <div class="price-row">
                        <div><span class="prod-price">₹299</span> <span class="prod-old">₹499</span></div>
                        <div class="rating">★ 4.5 <span> (512)</span></div>
                    </div>
                </div>
            </div>
        </article>

        <!-- Product 5 -->
        <article class="product-card" data-category="others" data-id="p5">
            <div class="product-thumb">
                <img src="{%static 'assets/images/products/p5.jpg'%}" alt="Neck Pillow">
                <div class="prod-badge">Others</div>
                <button class="view-btn" data-id="p5">View</button>
            </div>
            <div class="product-meta">
                <div class="product-info">
                    <div class="product-title">Ergonomic Neck Pillow</div>
                    <div class="product-cat">Memory foam</div>
                    <div class="price-row">
                        <div><span class="prod-price">₹149</span> <span class="prod-old">₹249</span></div>
                        <div class="rating">★ 4.4 <span> (78)</span></div>
                    </div>
                </div>
            </div>
        </article>

        <!-- Product 6 -->
        <article class="product-card" data-category="camping" data-id="p6">
            <div class="product-thumb">
                <img src="{%static 'assets/images/products/p6.jpg'%}" alt="Stove">
                <div class="prod-badge">Camping</div>
                <button class="view-btn" data-id="p6">View</button>
            </div>
            <div class="product-meta">
                <div class="product-info">
                    <div class="product-title">Portable Camping Stove</div>
                    <div class="product-cat">Lightweight, foldable</div>
                    <div class="price-row">
                        <div><span class="prod-price">₹249</span> <span class="prod-old">₹399</span></div>
                        <div class="rating">★ 4.3 <span> (45)</span></div>
                    </div>
                </div>
            </div>
        </article>
    </div>

    <!-- Modal container (hidden) -->
    <div id="modalRoot"></div>

</section>



<section class="prod-section page-wrapper my-2">
    <div class="prod-header">
        <div>
            <p class="prod-sub">Travel By our Interest</p>
            <h3 class="prod-title">Explore By Interest</h3>
        </div>


    </div>

    <!-- grid -->
    <div class="prod-grid" id="prodGrid">
        <!-- Sample product cards. You can render these from backend or JS -->
        <!-- Product 1: uses uploaded file path as example image -->
        <article class="product-card" data-category="electronics" data-id="p1">
            <div class="product-thumb">
                <img src="{%static 'assets/images/products/p1.jpg'%}" alt="Camera Kit">
                <div class="prod-badge">Electronics</div>
                <button class="view-btn" data-id="p1">View</button>
            </div>

            <div class="product-meta">
                <div class="product-info">
                    <div class="product-title">Pro Camera Kit</div>
                    <div class="product-cat">Mirrorless + Lenses</div>
                    <div class="price-row">
                        <div>
                            <span class="prod-price">₹1,499</span>
                            <span class="prod-old">₹2,199</span>
                        </div>
                        <div class="rating">★ 4.8 <span> (124)</span></div>
                    </div>
                </div>
            </div>
        </article>

        <!-- Product 2 -->
        <article class="product-card" data-category="camping" data-id="p2">
            <div class="product-thumb">
                <img src="{%static 'assets/images/products/p2.jpg'%}" alt="Tent">
                <div class="prod-badge">Camping</div>
                <button class="view-btn" data-id="p2">View</button>
            </div>
            <div class="product-meta">
                <div class="product-info">
                    <div class="product-title">Lightweight 2P Tent</div>
                    <div class="product-cat">4-season, waterproof</div>
                    <div class="price-row">
                        <div><span class="prod-price">₹499</span> <span class="prod-old">₹799</span></div>
                        <div class="rating">★ 4.6 <span> (89)</span></div>
                    </div>
                </div>
            </div>
        </article>

        <!-- Product 3 -->
        <article class="product-card" data-category="bag" data-id="p3">
            <div class="product-thumb">
                <img src="{%static 'assets/images/products/p3.jpg'%}" alt="Backpack">
                <div class="prod-badge">Bag Packing</div>
                <button class="view-btn" data-id="p3">View</button>
            </div>
            <div class="product-meta">
                <div class="product-info">
                    <div class="product-title">Carry-On Travel Backpack</div>
                    <div class="product-cat">35L, anti-theft</div>
                    <div class="price-row">
                        <div><span class="prod-price">₹899</span> <span class="prod-old">₹1,399</span></div>
                        <div class="rating">★ 4.7 <span> (203)</span></div>
                    </div>
                </div>
            </div>
        </article>

        <!-- Product 4 -->
        <article class="product-card" data-category="electronics" data-id="p4">
            <div class="product-thumb">
                <img src="{%static 'assets/images/products/p4.jpg'%}" alt="Powerbank">
                <div class="prod-badge">Electronics</div>
                <button class="view-btn" data-id="p4">View</button>
            </div>
            <div class="product-meta">
                <div class="product-info">
                    <div class="product-title">High-Capacity Powerbank</div>
                    <div class="product-cat">20000mAh</div>
                    <div class="price-row">
                        <div><span class="prod-price">₹299</span> <span class="prod-old">₹499</span></div>
                        <div class="rating">★ 4.5 <span> (512)</span></div>
                    </div>
                </div>
            </div>
        </article>

        <!-- Product 5 -->
        <article class="product-card" data-category="others" data-id="p5">
            <div class="product-thumb">
                <img src="{%static 'assets/images/products/p5.jpg'%}" alt="Neck Pillow">
                <div class="prod-badge">Others</div>
                <button class="view-btn" data-id="p5">View</button>
            </div>
            <div class="product-meta">
                <div class="product-info">
                    <div class="product-title">Ergonomic Neck Pillow</div>
                    <div class="product-cat">Memory foam</div>
                    <div class="price-row">
                        <div><span class="prod-price">₹149</span> <span class="prod-old">₹249</span></div>
                        <div class="rating">★ 4.4 <span> (78)</span></div>
                    </div>
                </div>
            </div>
        </article>

        <!-- Product 6 -->
        <article class="product-card" data-category="camping" data-id="p6">
            <div class="product-thumb">
                <img src="{%static 'assets/images/products/p6.jpg'%}" alt="Stove">
                <div class="prod-badge">Camping</div>
                <button class="view-btn" data-id="p6">View</button>
            </div>
            <div class="product-meta">
                <div class="product-info">
                    <div class="product-title">Portable Camping Stove</div>
                    <div class="product-cat">Lightweight, foldable</div>
                    <div class="price-row">
                        <div><span class="prod-price">₹249</span> <span class="prod-old">₹399</span></div>
                        <div class="rating">★ 4.3 <span> (45)</span></div>
                    </div>
                </div>
            </div>
        </article>
    </div>

    <!-- Modal container (hidden) -->
    <div id="modalRoot"></div>

</section>




<section class="experience-section page-wrapper my-2">
  <div class="experience-header">
    <span>Travel By Our Interest</span>
    <h2>Explore By Experience</h2>
  </div>

  <div class="experience-grid">

    <!-- Adventure -->
    <div class="experience-card">
      <div class="experience-icon"><i class="fas fa-mountain"></i></div>
      <div class="experience-img">
        <img src="{% static 'assets/img/interests/adventure.jpg' %}">
      </div>
      <div class="experience-body">
        <h4>Adventure Trips</h4>
        <p>Trekking • Rafting • Camping</p>
      </div>
    </div>

    <!-- Beach -->
    <div class="experience-card">
      <div class="experience-icon"><i class="fas fa-umbrella-beach"></i></div>
      <div class="experience-img">
        <img src="{% static 'assets/img/interests/beach.jpg' %}">
      </div>
      <div class="experience-body">
        <h4>Beach Holidays</h4>
        <p>Goa • Andaman • Maldives</p>
      </div>
    </div>

    <!-- Honeymoon -->
    <div class="experience-card">
      <div class="experience-icon"><i class="fas fa-heart"></i></div>
      <div class="experience-img">
        <img src="{% static 'assets/img/interests/honeymoon.jpg' %}">
      </div>
      <div class="experience-body">
        <h4>Honeymoon</h4>
        <p>Luxury • Romantic • Resorts</p>
      </div>
    </div>

    <!-- Wildlife -->
    <div class="experience-card">
      <div class="experience-icon"><i class="fas fa-paw"></i></div>
      <div class="experience-img">
        <img src="{% static 'assets/img/interests/wildlife.jpg' %}">
      </div>
      <div class="experience-body">
        <h4>Wildlife & Safari</h4>
        <p>Jungle • National Parks</p>
      </div>
    </div>

    <!-- Spiritual -->
    <div class="experience-card">
      <div class="experience-icon"><i class="fas fa-praying-hands"></i></div>
      <div class="experience-img">
        <img src="{% static 'assets/img/interests/religious.jpg' %}">
      </div>
      <div class="experience-body">
        <h4>Spiritual Tours</h4>
        <p>Temples • Ashrams • Yatra</p>
      </div>
    </div>



  </div>
</section>


<!-- Trip Selection Modal -->
<div class="modal fade" id="tripSelectionModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Select Trip</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="tripSelectionContent">
                <!-- Content will be loaded here -->
            </div>
        </div>
    </div>
</div>

<!-- Destination Selection Modal -->
<div class="modal fade" id="destinationSelectionModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Select Destination</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="destinationSelectionContent">
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    function showToast(title, message, type = 'info') {
        const toast = document.createElement('div');
        toast.className = `toast align-items-center text-white bg-${type} border-0`;
        toast.innerHTML = `
        <div class="d-flex">
            <div class="toast-body">
                <strong>${title}:</strong> ${message}
            </div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
        </div>
    `;

        document.body.appendChild(toast);
        const bsToast = new bootstrap.Toast(toast);
        bsToast.show();

        // Remove toast after it's hidden
        toast.addEventListener('hidden.bs.toast', () => {
            document.body.removeChild(toast);
        });
    }
    function showTripSelectionModal(destinationId, destinationName) {
        // Simulate loading user trips (replace with actual API call)
        const userTrips = [
            { id: 1, name: "Summer Vacation", destination: "Goa", date: "Aug 15-20, 2024" },
            { id: 2, name: "Business Trip", destination: "Delhi", date: "Sep 1-5, 2024" },
            { id: 3, name: "Family Holiday", destination: "Manali", date: "Dec 20-28, 2024" }
        ];

        let tripsHtml = '';
        if (userTrips.length === 0) {
            tripsHtml = `
            <div class="text-center py-4">
                <i class="fas fa-suitcase fa-3x text-muted mb-3"></i>
                <h6>No trips found</h6>
                <p class="text-muted">You don't have any active trips yet.</p>
                <button class="btn btn-primary" onclick="startNewTrip('${destinationId}', '${destinationName}')">
                    Create New Trip
                </button>
            </div>
        `;
        } else {
            tripsHtml = `
            <h6 class="mb-3">Select a trip to add ${destinationName}:</h6>
            <div class="trip-list">
        `;

            userTrips.forEach(trip => {
                tripsHtml += `
                <div class="trip-item card mb-2 hover-lift" onclick="addDestinationToTrip('${destinationId}', '${trip.id}')">
                    <div class="card-body">
                        <h6 class="card-title mb-1">${trip.name}</h6>
                        <p class="card-text text-muted small mb-1">${trip.destination}</p>
                        <p class="card-text text-muted small mb-0">${trip.date}</p>
                    </div>
                </div>
            `;
            });

            tripsHtml += `</div>`;
        }

        $('#tripSelectionContent').html(tripsHtml);

        const modal = new bootstrap.Modal(document.getElementById('tripSelectionModal'));
        modal.show();
    }

    function addDestinationToTrip(destinationId, tripId) {
        console.log('Adding destination to trip:', destinationId, tripId);

        // Close the modal
        $('#tripSelectionModal').modal('hide');

        showToast('Success', 'Destination added to your trip', 'success');

        // Redirect to trip detail page
        setTimeout(() => {
            window.location.href = `/trips/${tripId}/`;
        }, 1000);
    }
    function startNewTrip(destinationId, destinationName) {
        console.log('Starting new trip to:', destinationName);

        // Close the modal
        $('#destinationSelectionModal').modal('hide');

        // Show success message
        showToast('Success', `Starting new trip to ${destinationName}`, 'success');

        // Redirect to trip creation page after a short delay
        setTimeout(() => {
            window.location.href = `/trips/create/?destination=${encodeURIComponent(destinationName)}`;
        }, 1000);
    }

    function addToExistingTrip(destinationId, destinationName) {
        console.log('Adding to existing trip:', destinationName);

        // Close the modal
        $('#destinationSelectionModal').modal('hide');

        // Show trip selection modal
        showTripSelectionModal(destinationId, destinationName);
    }

    function addToWishlist(destinationId) {
        console.log('Adding to wishlist:', destinationId);
        showToast('Added to Wishlist', 'Destination saved to your wishlist', 'success');
    }

    function viewDestinationDetails(destinationId) {
        console.log('Viewing details for:', destinationId);
        window.location.href = `/destinations/${destinationId}/`;
    }

    function shareDestination(destinationId) {
        console.log('Sharing destination:', destinationId);

        if (navigator.share) {
            navigator.share({
                title: 'Amazing Destination',
                text: 'Check out this beautiful destination I found!',
                url: window.location.origin + '/destinations/' + destinationId + '/'
            });
        } else {
            showToast('Share', 'Copy the link to share', 'info');
        }
    }
    function showDestinationSelection(destination) {
        // Hide search results
        searchResults.hide();

        // Create selection content
        const selectionContent = `
        <div class="destination-selection">
            <!-- Destination Header -->
            <div class="destination-header text-center mb-4">
                <img src="${destination.image_url}" alt="${destination.name}" 
                     class="destination-main-image rounded-3 mb-3" style="height: 200px; width: 100%; object-fit: cover;">
                <h3 class="mb-2">${destination.name}</h3>
                <p class="text-muted mb-3">
                    <i class="fas fa-map-marker-alt me-1"></i>${destination.state}
                    <span class="mx-2">•</span>
                    ${destination.type}
                </p>
            </div>

            <!-- Trip Options -->
            <div class="trip-options mb-4">
                <h6 class="mb-3">How would you like to proceed?</h6>
                <div class="row g-3">
                    <div class="col-md-6">
                        <div class="option-card text-center p-4 rounded-3 border hover-lift" 
                             onclick="startNewTrip('${destination.id}', '${destination.name}')">
                            <div class="option-icon bg-primary rounded-circle p-3 mb-3 mx-auto">
                                <i class="fas fa-plus text-white fa-2x"></i>
                            </div>
                            <h6 class="mb-2">Plan New Trip</h6>
                            <p class="text-muted small mb-0">Create a new trip to ${destination.name}</p>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="option-card text-center p-4 rounded-3 border hover-lift" 
                             onclick="addToExistingTrip('${destination.id}', '${destination.name}')">
                            <div class="option-icon bg-success rounded-circle p-3 mb-3 mx-auto">
                                <i class="fas fa-suitcase text-white fa-2x"></i>
                            </div>
                            <h6 class="mb-2">Add to Existing Trip</h6>
                            <p class="text-muted small mb-0">Add this destination to one of your current trips</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="quick-actions mb-4">
                <h6 class="mb-3">Quick Actions</h6>
                <div class="d-flex flex-wrap gap-2">
                    <button class="btn btn-outline-primary btn-sm" onclick="addToWishlist('${destination.id}')">
                        <i class="fas fa-heart me-1"></i>Save to Wishlist
                    </button>
                    <button class="btn btn-outline-secondary btn-sm" onclick="viewDestinationDetails('${destination.id}')">
                        <i class="fas fa-info-circle me-1"></i>View Details
                    </button>
                    <button class="btn btn-outline-info btn-sm" onclick="shareDestination('${destination.id}')">
                        <i class="fas fa-share me-1"></i>Share
                    </button>
                </div>
            </div>

            <!-- Recent Activities (if any) -->
            <div class="recent-activities">
                <h6 class="mb-3">Recent Visitor Activities</h6>
                <div class="activity-stats">
                    <div class="row text-center">
                        <div class="col-4">
                            <div class="stat">
                                <div class="stat-number text-primary">124</div>
                                <div class="stat-label small">Trips Planned</div>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="stat">
                                <div class="stat-number text-success">4.8</div>
                                <div class="stat-label small">Average Rating</div>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="stat">
                                <div class="stat-number text-info">89%</div>
                                <div class="stat-label small">Recommend</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `;

        // Load content into modal
        $('#destinationSelectionContent').html(selectionContent);

        // Show modal
        const modal = new bootstrap.Modal(document.getElementById('destinationSelectionModal'));
        modal.show();

        // Add hover effects
        $('.option-card').hover(
            function () {
                $(this).css('transform', 'translateY(-3px)');
                $(this).css('border-color', 'var(--primary-color)');
            },
            function () {
                $(this).css('transform', 'translateY(0)');
                $(this).css('border-color', '#dee2e6');
            }
        );
    }

    function renderDestinations(destinations) {
        let html = '';
        destinations.forEach(dest => {
            console.log(dest);
            html += `
                <div class="col-xl-3 col-lg-4 col-md-6 mb-4">
                    <div class="destination-card card shadow-sm">
                        <div class="position-relative">
                            <img src="${dest.image_url}" class="destination-image card-img-top" alt="${dest.name}">
                            <span class="badge badge-destination">${dest.type}</span>
                        </div>
                        <div class="card-body">
                            <h5 class="card-title">${dest.name}</h5>
                            <p class="card-text text-muted small">
                                <i class="fas fa-map-marker-alt me-1"></i>
                                ${dest.state}
                            </p>
                            <p class="card-text">${dest.description}</p>
                            <div class="d-flex justify-content-between align-items-center">
                                <span class="badge bg-info">
                                    <i class="fas fa-star me-1"></i>Popular
                                </span>
                                <a href="${dest.url}" class="btn btn-sm btn-primary">Plan Trip</a>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        });

        $('#destinationsContainer').html(html);
    }
    const searchInput = $('#globalSearch');
    function displaySearchResults(results) {
        if (results.length === 0) {
            searchResults.html(`
            <div class="search-result-item">
                <div class="text-center text-muted py-4">
                    <i class="fas fa-search fa-2x mb-3"></i>
                    <h6>No destinations found</h6>
                    <p class="small">Try different search terms or browse all destinations</p>
                </div>
            </div>
        `).show();
            return;
        }

        let html = '';
        results.forEach(result => {
            html += `
            <div class="search-result-item" data-destination='${JSON.stringify(result)}'>
                <div class="d-flex align-items-center">
                    <img src="${result.image_url}" alt="${result.name}" 
                         class="rounded me-3" width="50" height="50" style="object-fit: cover;">
                    <div class="flex-grow-1">
                        <h6 class="mb-1">${result.name}</h6>
                        <small class="text-muted">
                            <i class="fas fa-map-marker-alt me-1"></i>${result.state}
                            <span class="mx-2">•</span>
                            ${result.type}
                        </small>
                    </div>
                    <div class="ms-3">
                        <i class="fas fa-chevron-right text-muted"></i>
                    </div>
                </div>
            </div>
        `;
        });

        searchResults.html(html).show();

        // Add click handler for destination selection
        $('.search-result-item').on('click', function () {
            const destination = $(this).data('destination');
            showDestinationSelection(destination);
        });
    }



    const searchResults = $('#searchResults');

    $(document).ready(function () {
        // Initialize counters with animation
        function animateCounter(element, target) {
            let current = 0;
            const increment = target / 100;
            const timer = setInterval(() => {
                current += increment;
                if (current >= target) {
                    clearInterval(timer);
                    element.text(target.toLocaleString());
                } else {
                    element.text(Math.floor(current).toLocaleString());
                }
            }, 20);
        }

        // Animate statistics
        setTimeout(() => {
            animateCounter($('#statDestinations'), 500);
            animateCounter($('#statTrips'), 10000);
            animateCounter($('#statHappy'), 95);
        }, 1000);

        // Floating search bar behavior
        const searchContainer = $('.floating-search-container');
        $(window).scroll(function () {
            if ($(this).scrollTop() > 100) {
                searchContainer.addClass('scrolled');
            } else {
                searchContainer.removeClass('scrolled');
            }
        });

        // Load states via API

        // Load popular destinations via API



        // Load data on page load
        loadStates();
        loadPopularDestinations();

        // Search functionality (using API)
        let searchTimeout;

        searchInput.on('input', function () {
            const query = $(this).val().trim();

            clearTimeout(searchTimeout);

            if (query.length < 2) {
                searchResults.hide().empty();
                return;
            }

            searchTimeout = setTimeout(() => {
                performSearch(query);
            }, 300);
        });



        // Hide results when clicking outside
        $(document).on('click', function (e) {
            if (!$(e.target).closest('.floating-search-container').length) {
                searchResults.hide();
            }
        });
    });


    // Define API URLs using Django template tags
    const API_URLS = {
        search: "{% url 'home:api_search' %}",
        states: "{% url 'home:api_states' %}",
        popularDestinations: "{% url 'home:api_popular_destinations' %}",
        destinationTypes: "{% url 'home:api_destination_types' %}"
    };

    function renderStates(states) {
        let html = '';
        states.forEach(state => {
            html += `
                <div class="col-xl-3 col-lg-4 col-md-6 mb-4">
                    <div class="state-card card shadow-sm">
                        <div class="position-relative">
                            <img src="${state.image_url}" class="state-image card-img-top" alt="${state.name}">
                            <div class="state-overlay">
                                <h5 class="card-title mb-0">${state.name}</h5>
                                <small>${state.destination_count} destinations</small>
                            </div>
                        </div>
                        <div class="card-body">
                            <p class="card-text text-muted small">${state.description}</p>
                            <a href="${state.url}" class="btn btn-sm btn-outline-primary">Explore ${state.code}</a>
                        </div>
                    </div>
                </div>
            `;
        });

        $('#statesContainer').html(html);

        // Add hover effects
        $('.state-card').hover(
            function () {
                $(this).find('.state-overlay').css('background', 'linear-gradient(transparent, var(--primary-color))');
            },
            function () {
                $(this).find('.state-overlay').css('background', 'linear-gradient(transparent, rgba(0, 0, 0, 0.8))');
            }
        );
    }

    // Load states via API
    function loadStates() {
        $.ajax({
            url: API_URLS.states,
            type: 'GET',
            success: function (response) {
                console.log(response);
                if (response.success) {
                    renderStates(response.states);
                } else {
                    $('#statesContainer').html(`
                    <div class="col-12 text-center">
                        <i class="fas fa-exclamation-triangle fa-2x text-warning mb-3"></i>
                        <p class="text-muted">Failed to load states. Please try again.</p>
                    </div>
                `);
                }
            },
            error: function () {
                $('#statesContainer').html(`
                <div class="col-12 text-center">
                    <i class="fas fa-exclamation-triangle fa-2x text-danger mb-3"></i>
                    <p class="text-muted">Error loading states. Please refresh the page.</p>
                </div>
            `);
            }
        });
    }

    // Load popular destinations via API
    function loadPopularDestinations() {
        $.ajax({
            url: API_URLS.popularDestinations,
            type: 'GET',
            success: function (response) {
                console.log("response", response);
                if (response.success) {
                    renderDestinations(response.destinations);
                } else {
                    $('#destinationsContainer').html(`
                    <div class="col-12 text-center">
                        <i class="fas fa-exclamation-triangle fa-2x text-warning mb-3"></i>
                        <p class="text-muted">Failed to load destinations.</p>
                    </div>
                `);
                }
            },
            error: function () {
                $('#destinationsContainer').html(`
                <div class="col-12 text-center">
                    <i class="fas fa-exclamation-triangle fa-2x text-danger mb-3"></i>
                    <p class="text-muted">Error loading destinations.</p>
                </div>
            `);
            }
        });
    }

    // Search functionality
    function performSearch(query) {
        showLoading(searchInput);

        $.ajax({
            url: API_URLS.search,
            type: 'GET',
            data: { q: query },
            success: function (response) {
                hideLoading(searchInput);

                if (response.success) {
                    displaySearchResults(response.results);
                } else {
                    searchResults.html(`
                    <div class="search-result-item">
                        <div class="text-center text-muted py-3">
                            ${response.message}
                        </div>
                    </div>
                `).show();
                }
            },
            error: function () {
                hideLoading(searchInput);
                searchResults.html(`
                <div class="search-result-item">
                    <div class="text-center text-danger py-3">
                        <i class="fas fa-exclamation-circle me-2"></i>
                        Search failed. Please try again.
                    </div>
                </div>
            `).show();
            }
        });
    }
</script>

<script>
    /* =========================
       HERO CAROUSEL (scoped)
       element IDs: #carouselContainer, #carousel, .card
       ========================= */
    (function HeroCarousel() {
        const container = document.getElementById('carouselContainer');
        const carousel = document.getElementById('carousel');
        if (!container || !carousel) return;

        // scope cards to this carousel
        const cards = Array.from(carousel.querySelectorAll('.card'));
        if (cards.length === 0) return;

        // state (scoped)
        let hero_currentIndex = 0;
        let hero_isPlaying = true;
        let hero_isDragging = false;
        let hero_startPos = 0;
        let hero_velocity = 0;
        let hero_lastTime = 0;
        let hero_lastPos = 0;
        let hero_animationID = 0;
        let hero_autoInterval = null;

        // controls
        const playPauseBtn = document.getElementById('playPauseBtn');

        // clones for infinite loop (scoped)
        const firstClone = cards[0].cloneNode(true);
        const lastClone = cards[cards.length - 1].cloneNode(true);
        firstClone.id = 'hero-first-clone';
        lastClone.id = 'hero-last-clone';
        carousel.appendChild(firstClone);
        carousel.insertBefore(lastClone, carousel.firstChild);

        // recompute lists
        const allCards = Array.from(carousel.querySelectorAll('.card'));
        let hero_cardWidth = cards[0].offsetWidth + 30;

        function updateHeroClasses(animate = true) {
            allCards.forEach(c => c.classList.remove('active', 'left', 'right', 'hidden'));
            cards.forEach((card, idx) => {
                if (idx === hero_currentIndex) card.classList.add('active');
                else if (idx === (hero_currentIndex - 1 + cards.length) % cards.length) card.classList.add('left');
                else if (idx === (hero_currentIndex + 1) % cards.length) card.classList.add('right');
                else card.classList.add('hidden');
                card.style.transition = animate ? 'transform 0.6s ease, opacity 0.6s ease' : 'none';
            });
        }

        function heroHandleTransitionEnd() {
            // if we landed on clone, reset index (use allCards to check)
            const idxInAll = hero_currentIndex + 1; // because we inserted lastClone at first
            if (allCards[idxInAll] && allCards[idxInAll].id === 'hero-first-clone') {
                // jumped past last -> reset to 0
                hero_currentIndex = 0;
                updateHeroClasses(false);
            }
            if (allCards[idxInAll] && allCards[idxInAll].id === 'hero-last-clone') {
                hero_currentIndex = cards.length - 1;
                updateHeroClasses(false);
            }
        }

        carousel.addEventListener('transitionend', heroHandleTransitionEnd);

        function heroTouchStart(e) {
            stopHeroAuto();
            hero_isDragging = true;
            hero_startPos = getPosX(e);
            hero_lastPos = hero_startPos;
            hero_lastTime = Date.now();
            hero_animationID = requestAnimationFrame(heroAnimation);
            carousel.classList.add('grabbing');
        }

        function heroTouchMove(e) {
            if (!hero_isDragging) return;
            const currentPos = getPosX(e);
            const now = Date.now();
            const dt = now - hero_lastTime;
            if (dt > 0) {
                hero_velocity = (currentPos - hero_lastPos) / dt;
                hero_lastTime = now;
                hero_lastPos = currentPos;
            }
        }

        function heroTouchEnd() {
            if (!hero_isDragging) return;
            hero_isDragging = false;
            cancelAnimationFrame(hero_animationID);
            carousel.classList.remove('grabbing');

            const momentum = hero_velocity * 200;
            let swipeDist = (hero_lastPos || 0) - hero_startPos;
            swipeDist += momentum;
            if (Math.abs(swipeDist) > hero_cardWidth / 3 || Math.abs(hero_velocity) > 0.5) {
                if (swipeDist > 0 || hero_velocity > 0) {
                    hero_currentIndex = (hero_currentIndex - 1 + cards.length) % cards.length;
                } else {
                    hero_currentIndex = (hero_currentIndex + 1) % cards.length;
                }
            }
            updateHeroClasses();
            hero_velocity = 0;
            hero_lastTime = 0;
            hero_lastPos = 0;
            if (hero_isPlaying) startHeroAuto();
        }

        function heroAnimation() {
            if (hero_isDragging) requestAnimationFrame(heroAnimation);
        }

        function getPosX(e) {
            return e.type.includes('mouse') ? e.pageX : e.touches[0].clientX;
        }

        function startHeroAuto() {
            stopHeroAuto();
            hero_autoInterval = setInterval(() => {
                hero_currentIndex = (hero_currentIndex + 1) % cards.length;
                updateHeroClasses();
            }, 3000);
        }
        function stopHeroAuto() { if (hero_autoInterval) { clearInterval(hero_autoInterval); hero_autoInterval = null; } }

        // play/pause button safe hookup
        if (playPauseBtn) {
            playPauseBtn.addEventListener('click', () => {
                hero_isPlaying = !hero_isPlaying;
                if (hero_isPlaying) { startHeroAuto(); playPauseBtn.innerHTML = '❚❚'; }
                else { stopHeroAuto(); playPauseBtn.innerHTML = '►'; }
            });
        }

        // keyboard nav
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowLeft') { hero_currentIndex = (hero_currentIndex - 1 + cards.length) % cards.length; updateHeroClasses(); restartHeroAuto(); }
            else if (e.key === 'ArrowRight') { hero_currentIndex = (hero_currentIndex + 1) % cards.length; updateHeroClasses(); restartHeroAuto(); }
            else if (e.key === ' ') { hero_isPlaying = !hero_isPlaying; if (hero_isPlaying) startHeroAuto(); else stopHeroAuto(); e.preventDefault(); }
        });

        function restartHeroAuto() { stopHeroAuto(); if (hero_isPlaying) startHeroAuto(); }

        // initial
        updateHeroClasses(false);
        startHeroAuto();

        // drag listeners (scoped)
        carousel.addEventListener('mousedown', heroTouchStart);
        carousel.addEventListener('touchstart', heroTouchStart, { passive: true });
        carousel.addEventListener('mousemove', heroTouchMove);
        carousel.addEventListener('touchmove', heroTouchMove, { passive: true });
        carousel.addEventListener('mouseup', heroTouchEnd);
        carousel.addEventListener('mouseleave', heroTouchEnd);
        carousel.addEventListener('touchend', heroTouchEnd);

        // resize
        window.addEventListener('resize', () => {
            hero_cardWidth = cards[0].offsetWidth + 30;
            updateHeroClasses(false);
        });
    })();

    /* =========================
       CAROUSEL1 (scoped) — carousel1 with track
       element IDs: #carousel1, #track, .card1
       ========================= */
    (function CarouselOne() {
        const carousel1El = document.getElementById('carousel1');
        const trackEl = document.getElementById('track');
        if (!carousel1El || !trackEl) return;

        const cards1 = Array.from(trackEl.querySelectorAll('.card1'));
        if (cards1.length === 0) return;

        // scoped state
        let c1_index = 0;
        let c1_interval = null;
        let c1_isDragging = false;
        let c1_startX = 0;
        let c1_currentTranslate = 0;
        let c1_prevTranslate = 0;
        let c1_animationID = 0;

        // clone first N for smooth loop (N = min(3, cards1.length))
        const clonesToAppend = Math.min(3, cards1.length);
        for (let i = 0; i < clonesToAppend; i++) {
            const clone = cards1[i].cloneNode(true);
            trackEl.appendChild(clone);
        }

        function c1_autoScroll() {
            c1_index++;
            const step = carousel1El.offsetWidth / 3;
            trackEl.style.transition = 'transform 0.8s cubic-bezier(.25,.8,.25,1)';
            trackEl.style.transform = `translateX(-${step * c1_index}px)`;
            if (c1_index >= cards1.length) {
                setTimeout(() => {
                    trackEl.style.transition = 'none';
                    trackEl.style.transform = 'translateX(0)';
                    c1_index = 0;
                }, 850);
            }
        }

        function startC1() { stopC1(); c1_interval = setInterval(c1_autoScroll, 3000); }
        function stopC1() { if (c1_interval) { clearInterval(c1_interval); c1_interval = null; } }

        function getPosX1(e) { return e.type.includes('mouse') ? e.pageX : e.touches[0].clientX; }

        function c1_dragStart(e) {
            stopC1();
            c1_isDragging = true;
            c1_startX = getPosX1(e);
            c1_animationID = requestAnimationFrame(c1_animation);
            carousel1El.classList.add('grabbing');
        }
        function c1_dragMove(e) {
            if (!c1_isDragging) return;
            const currentX = getPosX1(e);
            c1_currentTranslate = c1_prevTranslate + currentX - c1_startX;
            trackEl.style.transform = `translateX(${c1_currentTranslate}px)`;
        }
        function c1_dragEnd() {
            cancelAnimationFrame(c1_animationID);
            c1_isDragging = false;
            const movedBy = c1_currentTranslate - c1_prevTranslate;
            const step = carousel1El.offsetWidth / 3;
            if (movedBy < -100) c1_index++;
            if (movedBy > 100) c1_index--;
            // clamp
            if (c1_index < 0) c1_index = 0;
            moveToIndex1();
            startC1();
            carousel1El.classList.remove('grabbing');
        }
        function c1_animation() { if (c1_isDragging) requestAnimationFrame(c1_animation); }

        function moveToIndex1() {
            const step = carousel1El.offsetWidth / 3;
            c1_currentTranslate = -c1_index * step;
            c3_prevTranslate = c1_currentTranslate;
            trackEl.style.transition = 'transform 0.5s ease-out';
            trackEl.style.transform = `translateX(${c1_currentTranslate}px)`;
        }

        // events
        carousel1El.addEventListener('mousedown', c1_dragStart);
        carousel1El.addEventListener('mousemove', c1_dragMove);
        carousel1El.addEventListener('mouseup', c1_dragEnd);
        carousel1El.addEventListener('mouseleave', () => c1_isDragging && c1_dragEnd());
        carousel1El.addEventListener('touchstart', c1_dragStart, { passive: true });
        carousel1El.addEventListener('touchmove', c1_dragMove, { passive: true });
        carousel1El.addEventListener('touchend', c1_dragEnd);

        // init
        startC1();
    })();

    /* =========================
       PLACES CAROUSEL (scoped)
       element IDs: #placesCarousel, #pt-next, #pt-prev
       ========================= */
    (function PlacesCarousel() {
        const pc = document.getElementById('placesCarousel');
        const nextBtn = document.getElementById('pt-next');
        const prevBtn = document.getElementById('pt-prev');
        if (!pc || !nextBtn || !prevBtn) return;

        // compute width including gap dynamically
        let place_cardWidth = (() => {
            const first = pc.querySelector('.place-card');
            if (!first) return 300;
            const style = window.getComputedStyle(first);
            const marginRight = parseFloat(style.marginRight || 0);
            // fallback to a base width + gap; you can adjust 25 to your CSS gap value
            return Math.round(first.offsetWidth + (marginRight || 25));
        })();

        let scrollAmount = 0;
        // handlers
        nextBtn.addEventListener('click', () => {
            scrollAmount = Math.min(scrollAmount + place_cardWidth, pc.scrollWidth - pc.clientWidth);
            pc.scrollTo({ left: scrollAmount, behavior: 'smooth' });
        });
        prevBtn.addEventListener('click', () => {
            scrollAmount = Math.max(scrollAmount - place_cardWidth, 0);
            pc.scrollTo({ left: scrollAmount, behavior: 'smooth' });
        });

        // update on resize
        window.addEventListener('resize', () => {
            // recalc card width and clamp scrollAmount
            const first = pc.querySelector('.place-card');
            if (first) {
                const style = window.getComputedStyle(first);
                const marginRight = parseFloat(style.marginRight || 0);
                place_cardWidth = Math.round(first.offsetWidth + (marginRight || 25));
            }
            scrollAmount = Math.min(scrollAmount, pc.scrollWidth - pc.clientWidth);
        });
    })();
</script>


<script>
    /* ---------------------  TABS FILTER  ---------------------- */
    document.querySelectorAll(".nh-tab").forEach(tab => {
        tab.addEventListener("click", function () {

            document.querySelectorAll(".nh-tab").forEach(t => t.classList.remove("active"));
            this.classList.add("active");

            const filter = this.dataset.filter;
            const cards = document.querySelectorAll(".nh-card");

            cards.forEach(card => {
                if (filter === "hotel") {
                    card.style.display = "block";
                } else if (card.dataset.type === filter) {
                    card.style.display = "block";
                } else {
                    card.style.display = "none";
                }
            });
        });
    });

    /* ---------------------  LOCATION DETECTION  ---------------------- */
    const locText = document.getElementById("locText");

    function detectLocation() {
        if (!navigator.geolocation) {
            locText.innerText = "Set Location";
            return;
        }
        navigator.geolocation.getCurrentPosition(success, error);
    }

    function success(pos) {
        const lat = pos.coords.latitude;
        const lon = pos.coords.longitude;

        // Reverse geocode (FREE API)
        fetch(`https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${lat}&lon=${lon}`)
            .then(res => res.json())
            .then(data => {
                if (data.address.city) locText.innerText = data.address.city;
                else if (data.address.town) locText.innerText = data.address.town;
                else locText.innerText = "Unknown";
            });
    }
    function error() {
        locText.innerText = "Set Location";
    }

    detectLocation();

    /* ---------------------  LOCATION SUGGESTIONS  ---------------------- */
    const locationBox = document.getElementById("locationSuggestions");
    const cities = [
        "Pune", "Mumbai", "Delhi", "Bangalore",
        "Chennai", "Hyderabad", "Kolkata", "Goa",
        "Ahmedabad", "Nagpur", "Jaipur"
    ];

    document.getElementById("locationPicker").addEventListener("click", () => {
        locationBox.innerHTML = "";
        cities.forEach(c => {
            locationBox.innerHTML += `<div class="loc-suggest-item">${c}</div>`;
        });
        locationBox.style.display = "block";
    });

    locationBox.addEventListener("click", (e) => {
        if (e.target.classList.contains("loc-suggest-item")) {
            locText.innerText = e.target.innerText;
            locationBox.style.display = "none";
        }
    });

    // Hide on outside click
    document.addEventListener("click", (e) => {
        if (!e.target.closest("#locationPicker")) {
            locationBox.style.display = "none";
        }
    });
</script>

<script>
    (function () {
        // Tab filtering
        const tabs = document.querySelectorAll('.prod-tab');
        const grid = document.getElementById('prodGrid');
        const cards = Array.from(grid.querySelectorAll('.product-card'));

        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                tabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                const filter = tab.dataset.filter;
                cards.forEach(c => {
                    const cat = c.dataset.category;
                    if (filter === 'all' || filter === cat) {
                        c.style.display = ''; // show (grid handles layout)
                        // re-trigger entrance animation
                        c.style.animation = 'none';
                        requestAnimationFrame(() => c.style.animation = '');
                    } else c.style.display = 'none';
                });
            });
        });

        // Quick view modal
        const modalRoot = document.getElementById('modalRoot');

        function openModal(product) {
            // build modal DOM
            modalRoot.innerHTML = `
        <div class="modal-backdrop" id="pm-backdrop">
          <div class="quick-modal" role="dialog" aria-modal="true">
            <button class="close-x" id="pm-close" title="Close">✕</button>
            <div class="quick-left">
              <img src="${product.img}" alt="${product.title}">
            </div>
            <div class="quick-right">
              <h3 style="margin:0">${product.title}</h3>
              <div style="color:var(--muted)">${product.category} • ${product.subtitle || ''}</div>
              <div style="margin-top:12px;font-size:20px;font-weight:800;color:var(--accent)">${product.price}</div>
              <p style="margin-top:12px;color:#334148">${product.description || 'High quality product for travel. Rent or buy options available.'}</p>
              <div style="margin-top:auto;display:flex;gap:8px;">
                <button class="btn-primary" id="pm-buy">View Details</button>
                <button class="btn-outline" id="pm-close2">Close</button>
              </div>
            </div>
          </div>
        </div>
      `;
            // events
            document.getElementById('pm-backdrop').addEventListener('click', (e) => {
                if (e.target.id === 'pm-backdrop') closeModal();
            });
            document.getElementById('pm-close').addEventListener('click', closeModal);
            document.getElementById('pm-close2').addEventListener('click', closeModal);
            function closeModal() { modalRoot.innerHTML = ''; }
        }

        // prepare product lookup
        const productMap = {};
        cards.forEach(c => {
            const id = c.dataset.id;
            productMap[id] = {
                id,
                title: c.querySelector('.product-title')?.textContent || '',
                category: c.querySelector('.product-cat')?.textContent || '',
                price: c.querySelector('.prod-price')?.textContent || '',
                img: c.querySelector('.product-thumb img')?.src || '',
                subtitle: c.querySelector('.product-cat')?.textContent || '',
                description: c.querySelector('.product-cat')?.textContent || ''
            };
        });

        // attach view button handlers
        grid.addEventListener('click', (e) => {
            const btn = e.target.closest('.view-btn');
            if (!btn) return;
            const id = btn.dataset.id;
            const product = productMap[id];
            if (product) openModal(product);
        });

        // keyboard: close modal on Esc
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') document.getElementById('modalRoot').innerHTML = '';
        });

        // optional: lazy-load images (simple)
        document.querySelectorAll('.product-thumb img').forEach(img => {
            if ('loading' in HTMLImageElement.prototype) img.loading = 'lazy';
        });

    })();
</script>
{% endblock %}